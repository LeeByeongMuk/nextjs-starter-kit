services:
  next_js:
    image: 'node:20'
    build: docker/next/Dockerfile
    # command: bash -c "npm install && npm run dev"
    volumes:
      - '.:/var/www'
    ports:
      - '${APP_PORT:-3000}:3000'
    networks:
      - next_js_kit

  express_js:
    image: 'node:20'
    build: docker/express/Dockerfile
    # command: bash -c "npm run server"
    volumes:
      - '.:/var/www'
    ports:
      - '${APP_PORT:-80}:80'
    networks:
      - next_js_kit

  mysql:
    image: 'mysql/mysql-server:8.0'
    # command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_ROOT_PASSWORD: '${DB_PASSWORD:-password}'
      MYSQL_ROOT_HOST: '%'
      MYSQL_DATABASE: '${DB_DATABASE:-app-db}'
      MYSQL_USER: '${DB_USERNAME:-username}'
      MYSQL_PASSWORD: '${DB_PASSWORD:-password}'
      MYSQL_ALLOW_EMPTY_PASSWORD: 1
    # todo : healthcheck
    ports:
      - '${FORWARD_DB_PORT:-3306}:3306'
    networks:
      - next_js_kit

  shadow_mysql:
    image: 'mysql/mysql-server:8.0'
    # command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_ROOT_PASSWORD: '${SHADOW_DB_PASSWORD:-password}'
      MYSQL_ROOT_HOST: '%'
      MYSQL_DATABASE: '${SHADOW_DB_DATABASE:-shadow-db}'
      MYSQL_USER: '${SHADOW_DB_USERNAME:-username}'
      MYSQL_PASSWORD: '${SHADOW_DB_PASSWORD:-password}'
      MYSQL_ALLOW_EMPTY_PASSWORD: 1
    ports:
      - '${FORWARD_SHADOW_DB_PORT:-3307}:3306'
    networks:
      - next_js_kit

networks:
  next_js_kit:
    driver: bridge
